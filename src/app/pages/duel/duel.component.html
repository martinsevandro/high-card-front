<app-navbar></app-navbar> 
<!-- <p class="text-white">
  DEBUG: inMatch={{ inMatch }}, roundPhase={{ roundPhase }}, deckSize={{
    currentDeck.length
  }}
</p> -->

<div class="p-6">
  <p class="text-xl font-semibold mb-4 text-white">{{ statusMessage }}</p>

  <!-- Quando não está em partida -->
  <div *ngIf="!inMatch && (roundPhase === 'done' || roundPhase === 'idle')" class="space-y-4">
    <button
      *ngIf="!inQueue"
      class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
      (click)="joinQueue()"
    >
      Entrar na fila
    </button>

    <button
      *ngIf="inQueue"
      class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600"
      (click)="leaveQueue()"
    >
      Sair da fila
    </button>
  </div>

  <!-- Durante a partida -->
  <div *ngIf="inMatch || roundPhase === 'result' || roundPhase === 'done'">
    
    <div *ngIf="roundPhase === 'selection'" class="space-y-4">
      <p class="text-white font-bold mb-2">Escolha uma carta:</p>
      <div class="flex flex-row gap-4 justify-center flex-wrap md:flex-nowrap">
        <app-card
          *ngFor="let card of currentDeck"
          [card]="card"
          (click)="playCard(card)"
          class="cursor-pointer hover:scale-105 transition duration-200"
        ></app-card>
      </div>
    </div>

    <div *ngIf="roundPhase === 'waiting'" class="space-y-4">
      <p class="text-white">Aguardando o oponente jogar...</p>
      <p class="text-white font-bold">Sua carta:</p>
      <app-card [card]="selectedCard"></app-card>
    </div>

    <!-- resultado extrapolando as cartas aqui -->
    <div
      *ngIf="roundPhase === 'result' && (roundHistory.length > 0 || statusMessage)"
      class="space-y-6"
    >
      <div *ngIf="lastRound() as lr" class="flex flex-col items-center">

        <div class="flex flex-row gap-4 justify-center flex-wrap">

          <div class="flex flex-col items-center">
            <div class="text-sm text-gray-300 mb-2">Você</div>
            <app-card [card]="lr.myCard"></app-card> 
          </div>

          <div class="flex flex-col items-center">
            <div class="text-sm text-gray-300 mb-2"> {{ opponent || "Oponente" }} </div>
            <app-card [card]="lr.opponentCard"></app-card>
          </div>

        </div>
 
        <p class="text-white mt-4 text-center font-semibold">
          {{ lr.result || statusMessage }}
        </p>
 
        <div class="flex justify-center gap-4 mt-4">
          <button
            *ngIf="!duelFinished"
            type="button"
            class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600"
            (click)="startNextRound()"
          >
            Próxima rodada
          </button>

          <button
            *ngIf="duelFinished && roundPhase === 'result'"
            type="button"
            class="bg-gray-700 text-white px-4 py-2 rounded hover:bg-gray-800"
            (click)="finalizeStats()"
          >
            Encerrar estatísticas
          </button>
        </div>
      </div>

      <!-- Se ainda não houver lastRound, mostra só a mensagem (casos de disconect do oponente)-->
      <div *ngIf="!lastRound() && statusMessage" class="text-center text-white"> 
        <div class="flex justify-center mt-4">
          <button
            *ngIf="duelFinished"
            class="bg-gray-700 text-white px-4 py-2 rounded hover:bg-gray-800"
            (click)="finalizeStats()"
          >
            Encerrar estatísticas
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
